@using Purrfect_Blog_Starter.ViewModels;
@model IEnumerable<SavedFactsViewModel>

@{
    ViewBag.Title = "Favourites";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container my-4">
    <div class="row">
        <div class="mx-auto">
            <div class="card shadow-sm">
                <div class="card-header d-flex align-items-center justify-content-between">
                    <span class="fw-semibold">Favourites</span>
                </div>

                <div class="card-body p-0">
                    @if (Model.Any())
                    {
                        <ul class="list-group list-group-flush facts-scroll">
                            @foreach (var fact in Model)
                            {
                                <li class="list-group-item d-flex align-items-start justify-content-between">
                                    <span class="me-3">@fact.Description</span>
                                    <button type="button"
                                            class="btn btn-outline-danger btn-sm btn-fixed"
                                            data-bs-toggle="modal"
                                            data-bs-target="#deleteModal"
                                            data-fact-id="@fact.Id"
                                            data-fact-text="@fact.Description">
                                        Delete
                                    </button>
                                </li>
                            }
                        </ul>
                    }
                    else
                    {
                        <div class="p-4 text-center text-muted">
                            No data to display.
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content card shadow-sm">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="modal-title" id="deleteModalLabel">Confirm deletion</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="card-body">
                <p id="factText" class="mb-0 text-muted"></p>
                <hr>
                <p class="text-danger mt-2">Are you sure you want to remove this fact from favourites?</p>
            </div>
            <div class="card-footer d-flex justify-content-end">
                @using (Html.BeginForm("Delete", "Cat", FormMethod.Post, new { id = "deleteForm" }))
                {
                    @Html.AntiForgeryToken()
                    @Html.Hidden("id", "", new { id = "factIdInput" })
                    <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger">Delete</button>
                }
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        var deleteModal = document.getElementById('deleteModal');
        deleteModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget; 
            var factId = button.getAttribute('data-fact-id');
            var factText = button.getAttribute('data-fact-text');

            var factIdInput = deleteModal.querySelector('#factIdInput');
            var factTextContainer = deleteModal.querySelector('#factText');

            factIdInput.value = factId;
            factTextContainer.textContent = factText;
        });
    </script>
}